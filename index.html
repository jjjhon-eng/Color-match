<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>颜色配对（公平版）</title>
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --border:#e9ecf4; --muted:#667085; }
    html, body { height: 100%; -webkit-text-size-adjust: 100%; }
    body{
      margin:0; background:var(--bg); color:#222;
      font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",Arial,sans-serif;
      display:flex; align-items:center; justify-content:center; min-height:100vh;
      touch-action: manipulation; -webkit-user-select:none; user-select:none;
    }
    .app{ width:min(720px,95vw); background:var(--card); border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.08);
      padding:20px; text-align:center; }
    h1{ margin:8px 0 10px; }
    .stats{ display:flex; justify-content:space-around; margin:8px 0 16px; }
    .pill{ background:#eef1f6; padding:8px 14px; border-radius:999px; font-weight:700; }
    .card{ border:2px solid var(--border); border-radius:14px; padding:28px 16px; margin:10px 0 16px; }
    #word{ font-size:48px; font-weight:800; min-height:56px; }
    .btns{ display:flex; gap:12px; }
    button{ flex:1; border:0; border-radius:12px; padding:14px 16px; font-size:18px; font-weight:800; cursor:pointer; touch-action: manipulation; }
    .yes{ background:#e9f7ed; color:#0a7a3f; }
    .no{  background:#ffe9e9; color:#b00020; }
    .start{ background:#1a73e8; color:#fff; margin-top:12px; width:100%; }
    .tip{ margin-top:10px; color:var(--muted); font-size:14px; }
    .disabled{ opacity:.5; pointer-events:none; }
  </style>
</head>
<body>
  <div class="app">
    <h1>颜色配对（公平版）</h1>
    <div class="stats">
      <div class="pill">时间：<span id="time">60</span>s</div>
      <div class="pill">得分：<span id="score">0</span></div>
      <div class="pill">回合：<span id="round">0</span></div>
    </div>
    <div class="card">
      <div id="word">点「开始游戏」吧！</div>
    </div>

    <div class="btns">
      <button class="yes disabled" id="btnYes">一致</button>
      <button class="no  disabled" id="btnNo">不一致</button>
    </div>

    <button class="start" id="btnStart">开始游戏</button>
    <div class="tip">规则：系统尽量确保“对/错 50% : 50%”。答对 +10，答错 −10。倒计时 60 秒。</div>
  </div>

<script>
  // —— 去黄色、中文显示 —— //
  const WORDS = ['红色','蓝色','绿色','黑色','紫色','橙色'];
  const keyFromText = { '红色':'red','蓝色':'blue','绿色':'green','黑色':'black','紫色':'purple','橙色':'orange' };
  const colorKeys = Object.values(keyFromText);
  const cssMap = { red:'red', blue:'royalblue', green:'seagreen', black:'#111', purple:'rebeccapurple', orange:'orange' };

  let running=false, score=0, round=0, timeLeft=60, timer=null;
  let correctAnswer=null, matchCount=0, mismatchCount=0;

  // DOM
  const wordEl  = document.getElementById('word');
  const timeEl  = document.getElementById('time');
  const scoreEl = document.getElementById('score');
  const roundEl = document.getElementById('round');
  const btnYes  = document.getElementById('btnYes');
  const btnNo   = document.getElementById('btnNo');
  const btnStart= document.getElementById('btnStart');

  const rand = arr => arr[Math.floor(Math.random()*arr.length)];
  const revMap = Object.fromEntries(Object.entries(keyFromText).map(([cn,en]) => [en, cn]));

  function enablePlay(enable){
    [btnYes, btnNo].forEach(b => b.classList.toggle('disabled', !enable));
  }

  // 保持对/错尽量 50/50
  function nextShouldMatch(){
    if (matchCount > mismatchCount) return false;
    if (mismatchCount > matchCount) return true;
    return Math.random() < 0.5;
  }

  function newRound(){
    const shouldMatch = nextShouldMatch();
    let word, colorKey;
    if (shouldMatch){
      colorKey = rand(colorKeys);
      word = revMap[colorKey];
      correctAnswer = true;
      matchCount++;
    } else {
      word = rand(WORDS);
      const correctKey = keyFromText[word];
      colorKey = rand(colorKeys.filter(k => k !== correctKey));
      correctAnswer = false;
      mismatchCount++;
    }
    wordEl.textContent = word;
    wordEl.style.color = cssMap[colorKey] || colorKey;
    round += 1; roundEl.textContent = round;
  }

  function startGame(){
    if(running) return;
    running = true; score=0; round=0; timeLeft=60; matchCount=0; mismatchCount=0;
    scoreEl.textContent = score; roundEl.textContent = round; timeEl.textContent = timeLeft;
    btnStart.textContent = '进行中…'; btnStart.disabled = true; enablePlay(true);
    newRound();
    clearInterval(timer);
    timer = setInterval(()=>{
      timeLeft -= 1; timeEl.textContent = timeLeft;
      if(timeLeft<=0) endGame();
    }, 1000);
  }

  function endGame(){
    running=false; clearInterval(timer); enablePlay(false);
    btnStart.disabled=false; btnStart.textContent='再玩一次';
    wordEl.textContent = `时间到！最终得分：${score}`; wordEl.style.color = '#222';
  }

  function answer(isMatch){
    if(!running) return;
    if(isMatch === !!correctAnswer) score += 10; else score -= 10;
    scoreEl.textContent = score;
    newRound();
  }

  btnStart.addEventListener('click', startGame);
  btnYes.addEventListener('click', () => answer(true));
  btnNo .addEventListener('click', () => answer(false));

  // —— 防缩放 —— //
  let lastTouchEnd = 0;
  document.addEventListener('touchend', e => {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) e.preventDefault();
    lastTouchEnd = now;
  }, {passive:false});
  document.addEventListener('dblclick', e => e.preventDefault(), {passive:false});
  document.addEventListener('gesturestart', e => e.preventDefault());
</script>
</body>
</html>
